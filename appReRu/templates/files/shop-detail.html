{% extends 'files/base.html' %}
{% load static %}
{% block title %}Detail{% endblock %}
{% block content %}


<!-- Modal Search Start -->
<div class="modal fade" id="searchModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen">
        <div class="modal-content rounded-0">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Search by keyword</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body d-flex align-items-center">
                <div class="input-group w-75 mx-auto d-flex">
                    <input type="search" class="form-control p-3" placeholder="keywords"
                        aria-describedby="search-icon-1">
                    <span id="search-icon-1" class="input-group-text p-3"><i class="fa fa-search"></i></span>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Modal Search End -->
<br>
<!-- Single Product Start -->
<div class="container-fluid py-5 mt-5">
    <div class="container py-5">
        <div class="row g-4 mb-5">
            <div class="col-lg-8 col-xl-9">

                <!-- Custom button to go back to the shop -->
                <div class="row">
                    <div class="col-12">
                        <a href="{% url 'shop' %}" class="btn btn-primary mb-3 ms-1">Back to Shop</a>
                    </div>
                </div>
                <div class="row g-4">
                    <div class="col-lg-6">
                        <div class="border rounded">
                            <a href="#">
                                <img src="{{product.image.url}}" class="img-fluid rounded" alt="Image">
                            </a>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <h4 class="fw-bold mb-3">{{ product.name }}</h4>
                        <p id="currentCategory" class="mb-3">Category: {{ product.categories.name }}</p>
                        <h5 class="fw-bold mb-3">{{ product.price }}Kshs</h5>
                        <div class="d-flex mb-4">
                            <i class="fa fa-star text-secondary"></i>
                            <i class="fa fa-star text-secondary"></i>
                            <i class="fa fa-star text-secondary"></i>
                            <i class="fa fa-star text-secondary"></i>
                            <i class="fa fa-star"></i>
                        </div>
                        <p class="mb-4">{{ product.description }}</p>

                        {% if product.availability_status == 'available' %}
                        <a data-product="{{ product.id }}" data-action="add"
                            class="btn border border-secondary rounded-pill px-3 text-primary update-cart">
                            <i class="fa fa-shopping-bag me-2 text-primary"></i> Add to cart
                        </a>
                        {% else %}
                        <button class="btn border border-secondary rounded-pill px-3 text-primary" disabled>
                            Sold Out
                        </button>
                        {% endif %}
                    </div>
                    <hr>
                    <br>
                </div>
                <div class="col-lg-12">
                    <nav>
                        <div class="nav nav-tabs mb-3">
                            <button class="nav-link active border-white border-bottom-0" type="button" role="tab"
                                id="nav-about-tab" data-bs-toggle="tab" data-bs-target="#nav-about"
                                aria-controls="nav-about" aria-selected="true">Details</button>
                            <button class="nav-link border-white border-bottom-0" type="button" role="tab"
                                id="nav-mission-tab" data-bs-toggle="tab" data-bs-target="#nav-mission"
                                aria-controls="nav-mission" aria-selected="false">Reviews</button>
                        </div>
                    </nav>
                    <div class="tab-content mb-5">
                        <div class="tab-pane active" id="nav-about" role="tabpanel" aria-labelledby="nav-about-tab">
                            <p>{{product.details_1}}</p><br>
                            <p>{{product.details_2}}</p><br>
                            <p>{{product.details_3}}</p><br>
                        </div>
                        <div class="tab-pane" id="nav-mission" role="tabpanel" aria-labelledby="nav-mission-tab">
                            {% for review in reviews %}
                            <div class="d-flex">
                                <img src="{% static 'files/img/avatar.jpg' %}" class="img-fluid rounded-circle p-3"
                                    style="width: 100px; height: 100px;" alt="">
                                <div class="">
                                    <p class="mb-2" style="font-size: 14px;">{{review.date_created}}</p>
                                    <div class="d-flex justify-content-between">
                                        <h5>{{review.name}}</h5>
                                    </div>
                                    <p>{{review.review}}</p>
                                </div>
                            </div>
                            {% empty %}
                            <p>No reviews yet.</p>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <form method="post">
                    {% csrf_token %}
                    <h4 class="mb-5 fw-bold">Leave a Review</h4>
                    <div class="row g-4">
                        <div class="col-lg-6">
                            <div class="border-bottom rounded">
                                <input type="text" name="name" class="form-control border-0 me-4"
                                    placeholder="Yur Name *">
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="border-bottom rounded">
                                <input type="email" name="email" class="form-control border-0"
                                    placeholder="Your Email *">
                            </div>
                        </div>
                        <div class="col-lg-12">
                            <div class="border-bottom rounded my-4">
                                <textarea name="review" id="" class="form-control border-0" cols="30" rows="8"
                                    placeholder="Your Review *" spellcheck="false"></textarea>
                            </div>
                        </div>
                        <div class="col-lg-12">
                            <div class="d-flex justify-content-between py-3 mb-5">
                                <input id="" class="btn btn-success btn-block" type="submit" value="Post Review">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="col-lg-4 col-xl-3">
            <div class="row g-4 fruite">
                <div class="col-lg-12">
                    <div class="position-relative">
                        <h3 style="font-family: 'YourUniqueFont', sans-serif; color: orange;">Advertisement</h3>
                        {% if ad1 %}
                        {% if ad1.image %}
                        <a href="{{ ad1.link }}">
                            <img src="{{ ad1.image.url }}" class="img-fluid w-100 rounded" alt="">
                        </a>
                        {%else%}
                        <img src="{% static 'files/img/liquidity500..png' %}" class="img-fluid w-100 rounded" alt="">
                        {% endif %}
                        {% endif %}
                    </div>
                </div>
                <div class="col-lg-12">
                    <h4 class="mb-4">Featured products</h4>
                    {% for featured_product in featured_products %}
                    <div class="d-flex align-items-center justify-content-start mb-4">
                        <div class="rounded mr-3" style="width: 100px; height: 100px;">
                            <img src="{{ featured_product.image.url }}" class="img-fluid rounded"
                                alt="{{ featured_product.name }}">
                        </div>
                        <div>
                            <h6 class="mb-2">{{ featured_product.name }}</h6>
                            <div class="d-flex align-items-center mb-2">
                                <h5 class="fw-bold me-2">{{ featured_product.price }}kshs</h5>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <p>No featured products available.</p>
                    {% endfor %}
                    <div class="d-flex justify-content-center my-4">
                        <a href="#!" id="viewMoreButton"
                            class="btn border border-secondary px-4 py-3 rounded-pill text-primary">View
                            More</a>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="position-relative">
                        <h3 style="font-family: 'YourUniqueFont', sans-serif; color: orange;">Advertisement
                        </h3>
                        {% if ad %}
                        {% if ad.image %}
                        <a href="{{ ad.link }}">
                            <img src="{{ ad.image.url }}" class="img-fluid w-100 rounded" alt="">
                        </a>
                        {%else%}
                        <img src="{% static 'files/img/liquidity500..png' %}" class="img-fluid w-100 rounded" alt="">
                        {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="fw-bold mb-0">Related products</h1>
        <a href="#!" id="viewMoreButton1" class="btn border border-secondary px-4 py-3 rounded-pill text-primary">View
            More</a>
    </div>
    <div class="vesitable">
        <div class="row row-cols-1 row-cols-md-3 g-4">
            {% for featured_product in featured_products %}
            <div class="col">
                <div class="featured-product-item border border-primary rounded position-relative">
                    <div class="featured-product-img">
                        <img src="{{ featured_product.image.url }}" class="img-fluid rounded-top" alt="">
                    </div>
                    <div class="text-white bg-primary px-3 py-1 rounded position-absolute"
                        style="top: 10px; right: 10px;">
                        {{ featured_product.categories.name }}
                    </div>
                    <div class="p-4 pb-0 rounded-bottom">
                        <h4>{{ featured_product.name }}</h4>
                        <!-- <p>{{ featured_product.description }}</p>-->
                        <div class="d-flex justify-content-between">
                            <p class="text-dark fs-5 fw-bold">{{ featured_product.price }}Kshs</p>
                            <a href="{% url 'shop_detail' pk=featured_product.pk %}"
                                class="btn border border-secondary rounded-pill px-3 text-primary"><i
                                    class="fa fa-info-circle me-2 text-primary"></i> View Details</a>
                        </div>
                        <hr>
                        <br>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

    </div>
</div>
</div>
<!-- Single Product End -->
<script>
    document.getElementById('viewMoreButton').addEventListener('click', function () {
        // Extract the current category
        var currentCategory = document.getElementById('currentCategory').innerText.split(': ')[1].trim();

        // Construct the search query
        var searchQuery = '{% url "search" %}?query=' + currentCategory;

        // Redirect to the search view with the constructed query
        window.location.href = searchQuery;
    });
    document.getElementById('viewMoreButton1').addEventListener('click', function () {
        // Extract the current category
        var currentCategory = document.getElementById('currentCategory').innerText.split(': ')[1].trim();

        // Construct the search query
        var searchQuery = '{% url "search" %}?query=' + currentCategory;

        // Redirect to the search view with the constructed query
        window.location.href = searchQuery;
    });
</script>
{% endblock %}