{% extends 'files/base.html' %}
{% load static %}
{% block title %}Shop{% endblock %}
{% block content %}

<hr>
<br>

<!-- Fruits Shop Start-->
<div class="container-fluid fruite py-5">
    <div class="container py-5">
        <div class="row g-4">
            <div class="col-lg-12">
                <div class="row g-4">
                    <div class="col-xl-3">
                        <form class="text-center mt-5" action="{% url 'search' %}" method="get">
                            <div class="input-group input-group-lg">
                                <input type="search" name="query" id="search-input"
                                    class="form-control py-3 border-end-0 rounded-start"
                                    placeholder="Search for products..." aria-label="Search"
                                    aria-describedby="search-icon">
                                <button type="submit" class="btn btn-primary rounded-rect py-3 px-4 border-start-0">
                                    <i class="fa fa-search"></i>
                                </button>
                            </div>
                        </form>
                    </div>

                    <div class="col-xl-9">
                        <!-- Scrollable div for categories -->
                        <div class="overflow-auto bg-white p-3 scrollbar-hidden">
                            <div class="d-flex flex-xl-wrap">
                                <!-- Sample categories (replace with your actual categories) -->
                                {% for category in categories %}
                                <button class="btn btn-secondary rect-pill text-white me-2 mb-2 category-btn">
                                    {{ category.name }}
                                </button>
                                {% endfor %}
                            </div>
                        </div>
                    </div>


                </div>
                <br>
                <div class="row g-4 justify-content-center">
                    <!-- Product items will be dynamically loaded here -->
                    {% for product in products %}
                    <div class="col-md-6 col-lg-6 col-xl-4">
                        <div class="rounded position-relative fruite-item">
                            <div class="fruite-img">
                                <img src="{{ product.image.url }}" class="img-fluid w-100 rounded-top" alt="">
                            </div>
                            <div class="text-white bg-secondary px-3 py-1 rounded position-absolute"
                                style="top: 10px; left: 10px;">
                                {{ product.categories.name }}
                            </div>
                            <div class="p-4 border border-secondary border-top-0 rounded-bottom">
                                <h4>{{ product.name }}</h4>
                                <!--<p>{{ product.description }}</p>-->
                                <div class="d-flex justify-content-between flex-lg-wrap">
                                    <p class="text-dark fs-5 fw-bold mb-0">{{ product.price }}Kshs</p>
                                    <a href="{% url 'shop_detail' pk=product.pk %}"
                                        class="btn border border-secondary rounded-pill px-3 text-primary"><i
                                            class="fa fa-info-circle me-2 text-primary"></i> View Details</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="col-12">
                    <div class="pagination d-flex justify-content-center mt-5">
                        {% if products.has_previous %}
                        <a href="?page={{ products.previous_page_number }}" class="rounded">&laquo;</a>
                        {% endif %}
                        {% for page_num in page_range %}
                        <a href="?page={{ page_num }}"
                            class="rounded{% if page_num == current_page %} active{% endif %}">
                            {{ page_num }}
                        </a>
                        {% endfor %}
                        {% if products.has_next %}
                        <a href="?page={{ products.next_page_number }}" class="rounded">&raquo;</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Fruits Shop End-->

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Get all category buttons
        var categoryButtons = document.querySelectorAll('.category-btn');

        // Add click event listener to each category button
        categoryButtons.forEach(function (button) {
            button.addEventListener('click', function (event) {
                // Prevent the default action of the button
                event.preventDefault();

                // Get the category name from the button's text content
                var category = button.textContent.trim();

                // Construct the search URL with the category as the query parameter
                var searchURL = '{% url "search" %}?query=' + encodeURIComponent(category);

                // Redirect the user to the search view URL
                window.location.href = searchURL;
            });
        });
    });
</script>

{% endblock %}